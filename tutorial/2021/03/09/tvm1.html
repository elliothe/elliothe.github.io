<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ICRG @ Shanghai Jiao Tong University - TVM and VTA (1)</title>
  <meta name="description" content="step-by-step about setup TVM.">
  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="/tutorial/2021/03/09/tvm1.html">
  <!-- <link rel="shortcut icon" type ="image/x-icon" href="/images/favicon.ico"> -->
  <link rel="shortcut icon" type ="image/x-icon" href="/images/logo/sjtu_square_logo.ico">
  <script src="https://kit.fontawesome.com/a24320d871.js" crossorigin="anonymous"></script>



</head>





  <body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container-fluid">
	<div class="navbar-header">
	  <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
		<span class="sr-only">Toggle navigation</span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
		<span class="icon-bar"></span>
	  </button>

    <a class="navbar-brand" href="/">ICRG @ Shanghai Jiao Tong University</a>
	</div>
	<div class="collapse navbar-collapse" id="navbar-collapse-1">
	  <ul class="nav navbar-nav navbar-right">
		<li><a href="/">Home</a></li>
		<li><a href="/people">People</a></li>
		<li><a href="/news">News</a></li>
		<li><a href="/blog">Blog</a></li>
		<li><a href="/research">Research</a></li>
		<li><a href="/publications">Publications</a></li>
	  </ul>
	</div>
  </div>
</div>


    <div class="container-fluid">
      <div class="col-sm-12">
        <div class="row">
          <div class="row">
    <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/blog">Blog</a></li>
        <li class="breadcrumb-item text-capitalize"><a href="/blog#tutorial">tutorial</a></li>
        <li class="breadcrumb-item active" aria-current="page">TVM and VTA (1)</li>
    </ol>
    </nav>
</div>


<div class="post-image-feature">
  <img class="feature-image" src="https://xmfbit.github.io/img/tvm_introduction.jpg" alt="TVM and VTA (1) feature image" style="max-width: 500px;">

  
</div>
<!-- /.image-wrap -->



<div id="post">
  <header class="post-header">
    <h2 title="TVM and VTA (1)">TVM and VTA (1)</h2>
    <span class="post-meta">
      <span class="post-date">
        9 MAR 2021
      </span>
      •
      <span class="read-time" title="Estimated read time">
    
    
      4 mins read
    
  </span>
    </span>
  </header>

  <!-- add dummy space -->
  <hr>
  <p></p> 

  <article class="post-content">
    <p>List of Content</p>

<ul>
  <li>objective</li>
  <li>Install the TVM</li>
</ul>

<h2 id="objective">Objective</h2>
<hr>
<p>The objective of this post can be summarized as follows:</p>

<ul>
  <li>Get the TVM successfully installed and run.</li>
</ul>

<h2 id="installation">Installation</h2>

<hr>

<h3 id="pre-install-configuration">pre-install configuration</h3>

<p>As we may need to use the GPU for TVM, CUDA and cudnn should be installed within <code class="language-plaintext highlighter-rouge">/usr/local/cuda</code> path. The potential issue is that user may install the CUDA together with GPU driver (i.e., runfile), thus the CUDA path may not be <code class="language-plaintext highlighter-rouge">/usr/local/cuda</code>, which makes it difficult for TVM <code class="language-plaintext highlighter-rouge">config.cmake</code> file to locate the CUDA and cudnn path.</p>

<blockquote>
  <p><img class="emoji" title=":warning:" alt=":warning:" src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png" height="20" width="20"> double check the compatibility between GPU driver, CUDA, cudnn on <a href="https://docs.nvidia.com/deploy/cuda-compatibility/index.html#binary-compatibility">website</a></p>
</blockquote>

<h4 id="cuda">CUDA</h4>

<p>Download the CUDA (e.g., v-11) following instructions from <a href="https://developer.nvidia.com/cuda-11.1.0-download-archive">site</a>. Remeber to choose <code class="language-plaintext highlighter-rouge">deb(local)</code> if it is Ubuntu.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin
</code></pre></div></div>

<p>However, the above <code class="language-plaintext highlighter-rouge">wget</code> download cmd may fail due to the technical issue of website IP addr. It routes the connection to <code class="language-plaintext highlighter-rouge">developer.download.nvidia.com</code> to <code class="language-plaintext highlighter-rouge">developer.download.nvidia.cn</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(base) elliot@HomeWS:~/Documents/CUDA$ wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin --no-check-certificate
--2021-03-09 21:44:14--  https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin
Resolving developer.download.nvidia.com (developer.download.nvidia.com)... 45.43.38.237, 129.227.6.190, 129.227.6.189, ...
Connecting to developer.download.nvidia.com (developer.download.nvidia.com)|45.43.38.237|:443... connected.
HTTP request sent, awaiting response... 301 Moved Permanently
Location: https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin [following]
--2021-03-09 21:44:16--  https://developer.download.nvidia.cn/compute/cuda/repos/ubuntu2004/x86_64/cuda-ubuntu2004.pin
Resolving developer.download.nvidia.cn (developer.download.nvidia.cn)... 192.229.211.70
Connecting to developer.download.nvidia.cn (developer.download.nvidia.cn)|192.229.211.70|:443... connected.
WARNING: no certificate subject alternative name matches
	requested host name ‘developer.download.nvidia.cn’.
HTTP request sent, awaiting response... 404 Not Found
2021-03-09 21:44:17 ERROR 404: Not Found.
</code></pre></div></div>

<p>Alternative approach is using a computer with VPN to download the cudnn package, then send it to the target host:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>scp cuda-repo-ubuntu2004-11-0-local_11.0.2-450.51.05-1_amd64.deb user@&lt;IP-addr&gt;:&lt;target directory&gt;
<span class="nv">$ </span>scp cuda-ubuntu2004.pin user@&lt;IP-addr&gt;:&lt;target directory&gt;
</code></pre></div></div>

<p>Then apply the left cmd</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mv </span>cuda-ubuntu2004.pin /etc/apt/preferences.d/cuda-repository-pin-600
<span class="nb">sudo </span>dpkg <span class="nt">-i</span> cuda-repo-ubuntu2004-11-1-local_11.1.0-455.23.05-1_amd64.deb
<span class="nb">sudo </span>apt-key add /var/cuda-repo-ubuntu2004-11-1-local/7fa2af80.pub
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nt">-y</span> <span class="nb">install </span>cuda
</code></pre></div></div>

<h4 id="cudnn">cudnn</h4>

<p>Download the cudnn from the following <a href="https://developer.nvidia.com/cudnn">website</a>. As the downloading issue sustain, use a computer with VPN to download the cudnn package then send it to the target host:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>scp cudnn-9.0-linux-x64-v7.tgz user@&lt;IP-addr&gt;:&lt;target directory&gt;
</code></pre></div></div>

<h4 id="configurations">configurations</h4>

<p>following the commands described in <a href="https://docs.nvidia.com/deeplearning/cudnn/archives/cudnn_765/cudnn-install/index.html#installlinux-tar">nvidia-website</a>:</p>

<blockquote>
  <p><img class="emoji" title=":warning:" alt=":warning:" src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png" height="20" width="20"> the command in nvidia doc is wrong, error and solution can be found in <a href="https://github.com/pjreddie/darknet/issues/2356#issuecomment-756701965">github</a></p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xzvf</span> cudnn-9.0-linux-x64-v7.tgz

<span class="nv">$ </span><span class="nb">sudo cp </span>cuda/include/cudnn<span class="k">*</span>.h /usr/local/cuda/include  
<span class="nv">$ </span><span class="nb">sudo cp </span>cuda/lib64/libcudnn<span class="k">*</span> /usr/local/cuda/lib64
<span class="nv">$ </span><span class="nb">sudo chmod </span>a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn<span class="k">*</span>		
</code></pre></div></div>

<p>Inserting the following script in the <code class="language-plaintext highlighter-rouge">~/.bashrc</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">CUDA_HOME</span><span class="o">=</span>/usr/local/cuda:<span class="nv">$CUDA_HOME</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/usr/local/cuda/bin<span class="k">${</span><span class="nv">PATH</span>:+:<span class="k">${</span><span class="nv">PATH</span><span class="k">}}</span>
<span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="k">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="k">}</span>:/usr/local/cuda/lib64
</code></pre></div></div>

<h3 id="install-the-tvm">Install the TVM</h3>

<p>Here I choose to install by the conda environment from source.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone <span class="nt">--recursive</span> https://github.com/apache/tvm tvm
<span class="nb">cd </span>tvm

<span class="c"># Install the dependancy</span>
<span class="nb">sudo </span>apt-get update
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> python3 python3-dev python3-setuptools gcc libtinfo-dev zlib1g-dev build-essential cmake

<span class="c"># Install the LLVM</span>
<span class="nb">sudo </span>apt-get <span class="nb">install </span>llvm-11 <span class="c"># check the llvm version w.r.t linux dist</span>
dpkg <span class="nt">-L</span> llvm-11 <span class="c"># get the llvm-11 installed path</span>

<span class="nb">cd</span> &lt;path-to-tvm&gt;/tvm
<span class="nb">mkdir </span>build
<span class="nb">cp </span>cmake/config.cmake build

</code></pre></div></div>

<p>Update the configurations in <code class="language-plaintext highlighter-rouge">config.cmake</code>, for example the llvm path</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get the the path of llvm-config</span>
<span class="nb">set</span><span class="p">(</span>USE_LLVM /usr/lib/llvm-11/bin/llvm-config<span class="p">)</span>

<span class="nb">set</span><span class="p">(</span>USE_MICRO ON<span class="p">)</span> <span class="c1"># turn this on otherwise google_test unitest will fail</span>
<span class="c1"># https://discuss.tvm.apache.org/t/crttest-failed-no-rules-to-make-the-target-crttest/8450</span>
</code></pre></div></div>

<p>then build the tvm:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>build
cmake ..
make <span class="nt">-j4</span>
</code></pre></div></div>

<p>Create a conda environment for the TVM</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Create a conda environment with the dependencies specified by the yaml</span>
conda <span class="nb">env </span>create <span class="nt">--file</span> conda/build-environment.yaml
<span class="c"># Activate the created environment</span>
conda activate tvm-build
</code></pre></div></div>

<p>In order to use the TVM python package after the conda environment is configured, add the following command in <code class="language-plaintext highlighter-rouge">~.bashrc</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">TVM_HOME</span><span class="o">=</span>/path/to/tvm
<span class="nb">export </span><span class="nv">PYTHONPATH</span><span class="o">=</span><span class="nv">$TVM_HOME</span>/python:<span class="k">${</span><span class="nv">PYTHONPATH</span><span class="k">}</span>
</code></pre></div></div>

<p>Install some other packages</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda activate tvm-build
<span class="c"># pip can install under conda env</span>
<span class="c"># Necessary dependencies:</span>
pip3 <span class="nb">install</span> <span class="nt">--user</span> numpy decorator attrs <span class="c"># --user is not necessary if using conda or virtualenv</span>
pip3 <span class="nb">install </span>numpy decorator attrs

<span class="c">#want to use RPC</span>
pip3 <span class="nb">install</span> <span class="nt">--user</span> tornado
pip3 <span class="nb">install </span>tornado

<span class="c">#want to use auto-tuning module</span>
pip3 <span class="nb">install</span> <span class="nt">--user</span> tornado psutil xgboost cloudpickle
pip3 <span class="nb">install </span>tornado psutil xgboost cloudpickle
</code></pre></div></div>

<p>Install the testing</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ensure you are not under tvm</span>
git clone https://github.com/google/googletest
<span class="nb">cd </span>googletest
<span class="nb">mkdir </span>build
<span class="nb">cd </span>build
cmake ..
make
make <span class="nb">install</span> <span class="c"># may need sudo permission</span>
</code></pre></div></div>

<p>go back to the tvm and check the tvm code</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>tvm
./tests/scripts/task_cpp_unittest.sh
</code></pre></div></div>

<h2 id="webpages-to-check">Webpages to check</h2>

<ul>
  <li>https://tvm.apache.org/docs//vta/tutorials/index.html</li>
  <li>https://krantz-xrf.github.io/2019/10/24/tvm-workflow.html</li>
  <li><a href="https://zhuanlan.zhihu.com/p/83806067">编译安装TVM</a></li>
</ul>


  </article>
</div>

<!-- <div class="share-buttons">
  <h6>Share on: </h6>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/tutorial/2021/03/09/tvm1.html" class="twitter btn" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/tutorial/2021/03/09/tvm1.html" class="facebook btn" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/tutorial/2021/03/09/tvm1.html" class="google-plus btn" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
    <li>
      <a href="https://www.reddit.com/submit?url=/tutorial/2021/03/09/tvm1.html" class="reddit btn" title="Share on Reddit"><i class="fa fa-reddit"></i><span> Reddit</span></a>
    </li>
  </ul>
</div> -->
<!-- end share-buttons -->



        </div>
      </div>
    </div>

    <div id="footer" class="panel">
  <div class="panel-footer">
	<div class="container-fluid">
		<div class="row">
			<div class="col-sm-4">
				<!-- <p>ICRG@SJTU</p> -->
				<div class="text-center">
					<!-- <img class="img-fluid" src="/images/logo/lab-logo.png"
					 style="max-width: 100px;"> -->
					<!-- <p></p> 
					<img class="img-fluid" src="/images/logo/SJTU_logo_red.png"
					 style="max-width: 275px;"> -->
					<p style="width: 200px;">
						<script type="text/javascript" id="clustrmaps" src="//clustrmaps.com/map_v2.js?d=cZgyhvWI7eq-9SnsSsJVkhMVioGtOr0YJqI3-Ejt9C8&amp;cl=ffffff&amp;w=a"></script>
					</p>
				</div>
				<!-- <p>ICRG@SJTU is currently at Department of Computer Science and Engineering at Shanghai Jiao Tong University</p> -->
			</div>

			<div class="col-sm-4">
				<p>Links</p>
				<ul class="list-unstyled">
					<li><a href="/vacancies">Vacancies</a></li>
					<li><a href="https://github.com/ericdaat/research-lab-website">Website template</a></li>
					<!-- <li><a href="">Link</a></li>
					<li><a href="">Link</a></li> -->
				</ul>
			</div>

			<div class="col-sm-4">
				<p>Contact</p>
				<p><a href="mailto:zhezhi.he@sjtu.edu.cn"><i class="fas fa-paper-plane"></i></a> zhezhi.he at sjtu dot edu dot cn</p>
				<p><a href="https://j.map.baidu.com/fc/Sil"><i class="fas fa-map-marked-alt"></i></a> 800 DongChuan Road, SEIEE Building #03-501, Minhang District, Shanghai  </p>
			</div>
		</div>

		<div class="row mt-3">
			<p class="text-center">
				© 2021 ICRG@SJTU. Powered by <a href="http://jekyllrb.com/">Jekyll</a> and <a href="https://getbootstrap.com/">bootstrap</a>.
			</p>
			<!-- <p class="text-center">Copyright, 2019</p> -->
		</div>

		<div>
			<p class="text-center">
			<img class="img-fluid" src="/images/logo/SJTU_logo_red.png" style="max-width: 275px;">
			</p>
		</div>

	</div>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="/js/bootstrap.min.js"></script>


  </body>

</html>
